<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Clasificación de Señales Eléctricas - Perceptrón</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="fondo-personalizado text-white">
    <div class="container-fluid mt-4">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-10">
                <h1 class="text-center mb-4">
                    <i class="fas fa-bolt"></i> Clasificación de Señales Eléctricas Industriales
                </h1>
                <p class="text-center mb-4">
                    Utiliza nuestro modelo Perceptrón para predecir el estado de un sistema industrial basado en sus señales eléctricas.
                </p>

                <!-- Descripción del Dataset -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-dark border-primary shadow-lg">
                            <div class="card-header">
                                <h4><i class="fas fa-database"></i> Descripción del Dataset - Señales Eléctricas Industriales</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5><i class="fas fa-cog"></i> Variables del Dataset</h5>
                                        <div class="alert alert-info">
                                            <p><strong>Variables Numéricas (requieren escalado estándar):</strong></p>
                                            <ul>
                                                <li><strong>Voltaje Promedio (V):</strong> Tensión media de la señal eléctrica</li>
                                                <li><strong>Frecuencia (Hz):</strong> Oscilaciones por segundo de la señal</li>
                                                <li><strong>Duración Señal (ms):</strong> Tiempo de medición de la señal</li>
                                                <li><strong>Tasa de Cambio (V/s):</strong> Velocidad de variación del voltaje</li>
                                            </ul>
                                            <p><strong>Variables Categóricas:</strong> No aplica (todas son numéricas)</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h5><i class="fas fa-bullseye"></i> Clase Objetivo</h5>
                                        <div class="alert alert-success">
                                            <p><strong>Clase Positiva (1):</strong> Sistema Encendido/Funcionando</p>
                                            <p><strong>Clase Negativa (0):</strong> Sistema Apagado/Defectuoso</p>
                                            <hr>
                                            <p><strong>Distribución típica:</strong></p>
                                            <ul>
                                                <li>Sistema Encendido: Voltaje alto (~220V), frecuencia estable (~50Hz)</li>
                                                <li>Sistema Apagado: Voltaje bajo (~50V), frecuencia variable (~30Hz)</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formulario de predicción -->
                <div class="row mb-4">
                    <div class="col-lg-8 mx-auto">
                        <div class="card bg-dark border-secondary shadow-lg regression-card regression-form-card">
                            <div class="card-header">
                                <h4><i class="fas fa-wave-square"></i> Datos de la Señal Eléctrica</h4>
                            </div>
                            <div class="card-body p-4">
                                <form method="post">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="voltaje" class="form-label"><i class="fas fa-charging-station"></i> Voltaje Promedio (V):</label>
                                                <input type="number" step="any" class="form-control form-control-lg" id="voltaje" name="voltaje" required placeholder="Ej: 220.5">
                                                <small class="form-text text-muted">Nivel de tensión de la señal</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="frecuencia" class="form-label"><i class="fas fa-tachometer-alt"></i> Frecuencia (Hz):</label>
                                                <input type="number" step="any" class="form-control form-control-lg" id="frecuencia" name="frecuencia" required placeholder="Ej: 50.1">
                                                <small class="form-text text-muted">Oscilaciones por segundo</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="duracion" class="form-label"><i class="fas fa-hourglass-half"></i> Duración de Señal (ms):</label>
                                                <input type="number" step="any" class="form-control form-control-lg" id="duracion" name="duracion" required placeholder="Ej: 500">
                                                <small class="form-text text-muted">Tiempo de la medición</small>
                                            </div>
                                            <div class="mb-3">
                                                <label for="tasa_cambio" class="form-label"><i class="fas fa-chart-line"></i> Tasa de Cambio (V/s):</label>
                                                <input type="number" step="any" class="form-control form-control-lg" id="tasa_cambio" name="tasa_cambio" required placeholder="Ej: 10.2">
                                                <small class="form-text text-muted">Velocidad de variación del voltaje</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-4">
                                        <button type="submit" class="btn btn-primary btn-lg px-5">
                                            <i class="fas fa-cogs"></i> Clasificar Estado
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resultados de la predicción -->
                {% if resultado is not none %}
                <div class="row mb-4">
                    <div class="col-lg-8 mx-auto">
                        <div class="card bg-dark border-success shadow-lg regression-card regression-result-card">
                            <div class="card-header bg-success text-white">
                                <h4><i class="fas fa-bullseye"></i> Resultado de la Clasificación</h4>
                            </div>
                            <div class="card-body p-4">
                                <div class="row text-center">
                                    <div class="col-md-6 mb-3">
                                        <div class="alert {% if resultado == 'Sí' %}alert-success{% else %}alert-danger{% endif %} h-100">
                                            <h5><i class="fas {% if resultado == 'Sí' %}fa-check-circle{% else %}fa-times-circle{% endif %}"></i></h5>
                                            <strong>Predicción del Sistema:</strong><br>
                                            <span class="h4">{% if resultado == 'Sí' %}✅ Encendido{% else %}❌ Apagado{% endif %}</span>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="alert alert-info h-100">
                                            <h5><i class="fas fa-percentage"></i></h5>
                                            <strong>Probabilidad (Encendido):</strong><br>
                                            <span class="h4">{{ probabilidad }}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Métricas y Visualizaciones -->
                {% if metricas %}
                
                <!-- Exactitud destacada en tarjeta grande -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-gradient-primary border-0 shadow-lg text-white">
                            <div class="card-body text-center py-5">
                                <h2 class="card-title mb-3"><i class="fas fa-bullseye"></i> Exactitud del Modelo</h2>
                                <div class="display-3 fw-bold mb-3">{{ "%.2f"|format(metricas.accuracy * 100) }}%</div>
                                <p class="lead">El modelo Perceptrón predice correctamente el <strong>{{ "%.2f"|format(metricas.accuracy * 100) }}%</strong> de los casos de prueba</p>
                                <div class="row mt-4">
                                    <div class="col-md-4">
                                        <i class="fas fa-database fa-2x mb-2"></i>
                                        <p><strong>Datos de prueba evaluados</strong></p>
                                    </div>
                                    <div class="col-md-4">
                                        <i class="fas fa-brain fa-2x mb-2"></i>
                                        <p><strong>Algoritmo: Perceptrón</strong></p>
                                    </div>
                                    <div class="col-md-4">
                                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                                        <p><strong>Clasificación binaria</strong></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <!-- Reporte de clasificación en tabla HTML -->
                    <div class="col-lg-6 mb-4">
                        <div class="card bg-dark border-warning h-100 shadow regression-card">
                            <div class="card-header">
                                <h5><i class="fas fa-table"></i> Reporte de Clasificación</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped">
                                        <thead class="table-warning">
                                            <tr>
                                                <th>Clase</th>
                                                <th>Precisión</th>
                                                <th>Recall</th>
                                                <th>F1-Score</th>
                                                <th>Soporte</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge bg-danger">0</span> Apagado (No)</td>
                                                <td>{{ "%.3f"|format(metricas.precision_No) }}</td>
                                                <td>{{ "%.3f"|format(metricas.recall_No) }}</td>
                                                <td>{{ "%.3f"|format(metricas.f1_No) }}</td>
                                                <td>{{ metricas.support_No }}</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">1</span> Encendido (Sí)</td>
                                                <td>{{ "%.3f"|format(metricas.precision_Sí) }}</td>
                                                <td>{{ "%.3f"|format(metricas.recall_Sí) }}</td>
                                                <td>{{ "%.3f"|format(metricas.f1_Sí) }}</td>
                                                <td>{{ metricas.support_Sí }}</td>
                                            </tr>
                                            <tr class="table-info">
                                                <td><strong>Promedio</strong></td>
                                                <td><strong>{{ "%.3f"|format((metricas.precision_No + metricas.precision_Sí) / 2) }}</strong></td>
                                                <td><strong>{{ "%.3f"|format((metricas.recall_No + metricas.recall_Sí) / 2) }}</strong></td>
                                                <td><strong>{{ "%.3f"|format((metricas.f1_No + metricas.f1_Sí) / 2) }}</strong></td>
                                                <td><strong>{{ metricas.support_No + metricas.support_Sí }}</strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Matriz de Confusión 2x2 con encabezados claros -->
                    <div class="col-lg-6 text-center mb-4">
                        <div class="card bg-dark border-info h-100 shadow regression-card">
                            <div class="card-header">
                                <h5><i class="fas fa-th"></i> Matriz de Confusión 2×2</h5>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center">
                                <p class="text-muted small">Imagen con encabezados claros: <strong>Real 0/1 vs Predicho 0/1</strong></p>
                                <div class="chart-container">
                                    <img src="data:image/png;base64,{{ matriz_confusion_img }}" alt="Matriz de confusión 2x2 con encabezados Real vs Predicho" class="img-fluid rounded border">
                                </div>
                                <div class="mt-3">
                                    <small class="text-info">
                                        <i class="fas fa-info-circle"></i> 
                                        Filas: Valores Reales | Columnas: Predicciones del Modelo
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <!-- Gráfica de Errores de Entrenamiento -->
                    <div class="col-lg-8 mx-auto text-center mb-4">
                        <div class="card bg-dark border-primary shadow regression-card">
                            <div class="card-header">
                                <h6><i class="fas fa-chart-area"></i> Evolución de Errores Durante el Entrenamiento</h6>
                            </div>
                            <div class="card-body">
                                <p class="text-muted small">Número de errores (actualizaciones de pesos) en cada época de entrenamiento.</p>
                                <div class="chart-container">
                                    <img src="data:image/png;base64,{{ errores_entrenamiento_img }}" alt="Errores de entrenamiento" class="img-fluid rounded border">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Botones de navegación -->
                <div class="row">
                    <div class="col-12 text-center">
                        <div class="card bg-dark border-light shadow">
                            <div class="card-body py-4">
                                <a href="{{ url_for('index') }}" class="btn btn-outline-light btn-lg me-3 mb-2">
                                    <i class="fas fa-home"></i> Volver al Menú Principal
                                </a>
                                <a href="{{ url_for('conceptos_clasificacion') }}" class="btn btn-outline-info btn-lg mb-2">
                                    <i class="fas fa-book"></i> Conceptos de Clasificación
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>