import matplotlib.pyplot as plt
import pandas as pd
import os

# Suponiendo que 'modelo' y 'df' ya están definidos en otro lugar de tu código

def generar_grafica(temperatura=None, dia_semana=None, resultado=None, filename="grafica.png"):
    plt.figure(figsize=(10, 6))
    plt.scatter(df['Temperatura_C'], df['Ventas_Helados'], c=df['Dia_Semana'], cmap='viridis', label="Datos entrenamiento")
    plt.xlabel('Temperatura (°C)')
    plt.ylabel('Ventas de Helados')
    plt.title('Relación entre Temperatura y Ventas de Helados')
    temp_range = sorted(df['Temperatura_C'].unique())
    if dia_semana is not None:
        X_pred = pd.DataFrame({'Temperatura_C': temp_range, 'Dia_Semana': [dia_semana]*len(temp_range)})
        y_pred = modelo.predict(X_pred)
        plt.plot(temp_range, y_pred, color='gray', label=f"Tendencia Día {dia_semana}")
    if temperatura is not None and dia_semana is not None and resultado is not None:
        plt.scatter([temperatura], [resultado], color='red', s=120, label="Tu predicción")
    plt.legend()
    plt.tight_layout()
    static_folder = os.path.join(os.path.dirname(__file__), 'static')
    if not os.path.exists(static_folder):
        os.makedirs(static_folder)  # Crea la carpeta si no existe
    filepath = os.path.join(static_folder, filename)
    plt.savefig(filepath)
    plt.close()